<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Task Manager</title>-->
<!--    <style>-->
<!--        body { font-family: Arial; padding: 20px; }-->
<!--        input, button { margin: 5px; }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<h2>Task Manager</h2>-->
<!--<input type="text" id="title" placeholder="Title">-->
<!--<input type="text" id="description" placeholder="Description">-->
<!--<button onclick="addTask()">Add Task</button>-->
<!--<ul id="taskList"></ul>-->

<!--<script>-->
<!--    const API_URL = 'http://localhost:8080/api/tasks';-->

<!--    function fetchTasks() {-->
<!--        fetch(API_URL)-->
<!--            .then(res => res.json())-->
<!--            .then(data => {-->
<!--                const taskList = document.getElementById('taskList');-->
<!--                taskList.innerHTML = '';-->
<!--                data.forEach(task => {-->
<!--                    const li = document.createElement('li');-->
<!--                    li.innerHTML = `${task.title} - ${task.description} - -->
<!--                        <b>${task.completed ? 'Done' : 'Pending'}</b>-->
<!--                        <button onclick="deleteTask(${task.id})">Delete</button>-->
<!--                        <button onclick="toggleComplete(${task.id}, ${task.completed})">Toggle</button>`;-->
<!--                    taskList.appendChild(li);-->
<!--                });-->
<!--            });-->
<!--    }-->

<!--    function addTask() {-->
<!--        const title = document.getElementById('title').value;-->
<!--        const description = document.getElementById('description').value;-->

<!--        fetch(API_URL, {-->
<!--            method: 'POST',-->
<!--            headers: { 'Content-Type': 'application/json' },-->
<!--            body: JSON.stringify({ title, description, completed: false })-->
<!--        }).then(() => fetchTasks());-->
<!--    }-->

<!--    function deleteTask(id) {-->
<!--        fetch(`${API_URL}/${id}`, { method: 'DELETE' })-->
<!--            .then(() => fetchTasks());-->
<!--    }-->

<!--    function toggleComplete(id, currentStatus) {-->
<!--        fetch(`${API_URL}/${id}`, {-->
<!--            method: 'PUT',-->
<!--            headers: { 'Content-Type': 'application/json' },-->
<!--            body: JSON.stringify({ completed: !currentStatus })-->
<!--        }).then(() => fetchTasks());-->
<!--    }-->

<!--    fetchTasks();-->
<!--</script>-->
<!--</body>-->
<!--</html>-->

<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Task Manager</title>-->
<!--    <style>-->
<!--        * {-->
<!--            margin: 0;-->
<!--            padding: 0;-->
<!--            box-sizing: border-box;-->
<!--            font-family: 'Segoe UI', sans-serif;-->
<!--        }-->

<!--        body {-->
<!--            background: #f4f6f8;-->
<!--            padding: 40px;-->
<!--        }-->

<!--        .container {-->
<!--            max-width: 700px;-->
<!--            margin: auto;-->
<!--            background: #fff;-->
<!--            border-radius: 10px;-->
<!--            padding: 30px;-->
<!--            box-shadow: 0 4px 8px rgba(0,0,0,0.1);-->
<!--        }-->

<!--        h2 {-->
<!--            text-align: center;-->
<!--            margin-bottom: 25px;-->
<!--            color: #333;-->
<!--        }-->

<!--        .form {-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            gap: 15px;-->
<!--            margin-bottom: 20px;-->
<!--        }-->

<!--        .form input {-->
<!--            padding: 10px;-->
<!--            border: 1px solid #ccc;-->
<!--            border-radius: 6px;-->
<!--        }-->

<!--        .form button {-->
<!--            padding: 10px;-->
<!--            background-color: #28a745;-->
<!--            border: none;-->
<!--            border-radius: 6px;-->
<!--            color: white;-->
<!--            font-weight: bold;-->
<!--            cursor: pointer;-->
<!--            transition: background-color 0.3s;-->
<!--        }-->

<!--        .form button:hover {-->
<!--            background-color: #218838;-->
<!--        }-->

<!--        ul#taskList {-->
<!--            list-style: none;-->
<!--        }-->

<!--        li {-->
<!--            background-color: #f8f9fa;-->
<!--            padding: 15px;-->
<!--            margin-bottom: 10px;-->
<!--            border-radius: 6px;-->
<!--            display: flex;-->
<!--            justify-content: space-between;-->
<!--            align-items: center;-->
<!--        }-->

<!--        .task-info {-->
<!--            flex-grow: 1;-->
<!--        }-->

<!--        .task-info b {-->
<!--            color: #007bff;-->
<!--        }-->

<!--        .actions button {-->
<!--            margin-left: 10px;-->
<!--            padding: 6px 10px;-->
<!--            border: none;-->
<!--            border-radius: 4px;-->
<!--            cursor: pointer;-->
<!--            color: white;-->
<!--            font-size: 14px;-->
<!--        }-->

<!--        .delete-btn {-->
<!--            background-color: #dc3545;-->
<!--        }-->

<!--        .toggle-btn {-->
<!--            background-color: #17a2b8;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<div class="container">-->
<!--    <h2>üìù Task Manager</h2>-->
<!--    <div class="form">-->
<!--        <input type="text" id="title" placeholder="Enter task title">-->
<!--        <input type="text" id="description" placeholder="Enter task description">-->
<!--        <button onclick="addTask()">Add Task</button>-->
<!--    </div>-->
<!--    <ul id="taskList"></ul>-->
<!--</div>-->

<!--<script>-->
<!--    const API_URL = 'http://localhost:8080/api/tasks';-->

<!--    function fetchTasks() {-->
<!--        fetch(API_URL)-->
<!--            .then(res => res.json())-->
<!--            .then(data => {-->
<!--                const taskList = document.getElementById('taskList');-->
<!--                taskList.innerHTML = '';-->
<!--                data.forEach(task => {-->
<!--                    const li = document.createElement('li');-->
<!--                    li.innerHTML = `-->
<!--                        <div class="task-info">-->
<!--                            <strong>${task.title}</strong> - ${task.description} - -->
<!--                            <b>${task.completed ? 'Done ‚úÖ' : 'Pending ‚è≥'}</b>-->
<!--                        </div>-->
<!--                        <div class="actions">-->
<!--                            <button class="delete-btn" onclick="deleteTask(${task.id})">Delete</button>-->
<!--                            <button class="toggle-btn" onclick="toggleComplete(${task.id}, ${task.completed})">Toggle</button>-->
<!--                        </div>-->
<!--                    `;-->
<!--                    taskList.appendChild(li);-->
<!--                });-->
<!--            });-->
<!--    }-->

<!--    function addTask() {-->
<!--        const title = document.getElementById('title').value.trim();-->
<!--        const description = document.getElementById('description').value.trim();-->

<!--        if (!title || !description) {-->
<!--            alert("Please enter both title and description.");-->
<!--            return;-->
<!--        }-->

<!--        fetch(API_URL, {-->
<!--            method: 'POST',-->
<!--            headers: { 'Content-Type': 'application/json' },-->
<!--            body: JSON.stringify({ title, description, completed: false })-->
<!--        }).then(() => {-->
<!--            document.getElementById('title').value = '';-->
<!--            document.getElementById('description').value = '';-->
<!--            fetchTasks();-->
<!--        });-->
<!--    }-->

<!--    function deleteTask(id) {-->
<!--        if (confirm("Are you sure you want to delete this task?")) {-->
<!--            fetch(`${API_URL}/${id}`, { method: 'DELETE' })-->
<!--                .then(() => fetchTasks());-->
<!--        }-->
<!--    }-->

<!--    function toggleComplete(id, currentStatus) {-->
<!--        fetch(`${API_URL}/${id}`)-->
<!--            .then(res => res.json())-->
<!--            .then(existingTask => {-->
<!--                fetch(`${API_URL}/${id}`, {-->
<!--                    method: 'PUT',-->
<!--                    headers: { 'Content-Type': 'application/json' },-->
<!--                    body: JSON.stringify({-->
<!--                        ...existingTask,-->
<!--                        completed: !currentStatus-->
<!--                    })-->
<!--                }).then(() => fetchTasks());-->
<!--            });-->
<!--    }-->

<!--    fetchTasks();-->
<!--</script>-->
<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Task Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h2 {
            color: #333;
        }
        form {
            margin-bottom: 20px;
        }
        input, select, button {
            margin: 5px;
            padding: 8px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }
        button:disabled {
            background-color: #e0e0e0;
            cursor: not-allowed;
            color: #a0a0a0;
        }
    </style>
</head>
<body>
<h2>Task Manager</h2>

<!-- Form to add a new task -->
<!--<form th:action="@{/add}" method="post">-->
<!--    <input type="text" name="title" placeholder="Title" required>-->
<!--    <input type="text" name="description" placeholder="Description" required>-->
<!--    <input type="date" name="dueDate" placeholder="Due Date">-->
<!--    <select name="priority">-->
<!--        <option value="Low">Low</option>-->
<!--        <option value="Medium">Medium</option>-->
<!--        <option value="High">High</option>-->
<!--    </select>-->
<!--    <input type="text" name="username" placeholder="Username" required>-->
<!--    <button type="submit">Add Task</button>-->
<!--</form>-->

<form id="taskForm">
    <input type="text" name="title" placeholder="Title" required>
    <input type="text" name="description" placeholder="Description" required>
    <input type="date" name="dueDate" placeholder="Due Date">
    <select name="priority">
        <option value="Low">Low</option>
        <option value="Medium">Medium</option>
        <option value="High">High</option>
    </select>
    <input type="text" name="username" placeholder="Username" required>
    <button type="submit">Add Task</button>
</form>


<!-- Buttons for filters/sorting -->
<button onclick="filterCompleted(true)">Show Completed</button>
<button onclick="filterCompleted(false)">Show Pending</button>
<button onclick="sortByDueDate()">Sort by Due Date</button>
<input type="text" id="userFilter" placeholder="Filter by Username">
<button onclick="filterByUsername()">Filter</button>

<!-- Task list table -->
<table>
    <thead>
    <tr>
        <th>Title</th>
        <th>Description</th>
        <th>Status</th>
        <th>Due Date</th>
        <th>Priority</th>
        <th>Username</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody id="taskTableBody">
    <tr th:each="task : ${tasks}">
        <td th:text="${task.title}"></td>
        <td th:text="${task.description}"></td>
<!--        <td th:text="${task.completed} ? 'Done' : 'Pending'"></td>-->
        <td>
            <button onclick="toggleComplete(${task.id}, ${task.completed})">
                Mark as ${task.completed ? 'Pending' : 'Done'}
            </button>
        </td>

        <td th:text="${task.dueDate}"></td>
        <td th:text="${task.priority}"></td>
        <td th:text="${task.username}"></td>
    </tr>
    </tbody>
</table>

<script>

    const apiBase = '/api/tasks';

<!--function renderTasks(tasks) {-->
<!--    const tbody = document.getElementById('taskTableBody');-->
<!--    tbody.innerHTML = '';-->
<!--    tasks.forEach(task => {-->
<!--        const row = document.createElement('tr');-->
<!--        row.innerHTML = `-->
<!--            <td>${task.title}</td>-->
<!--            <td>${task.description}</td>-->
<!--            <td>-->
<!--                <button onclick="toggleComplete(${task.id}, ${task.completed})">-->
<!--                    ${task.completed ? 'Done' : 'Pending'}-->
<!--                </button>-->
<!--            </td>-->
<!--            <td>${task.dueDate || ''}</td>-->
<!--            <td>${task.priority || ''}</td>-->
<!--            <td>${task.username || ''}</td>-->

<!--            <td>-->
<!--                <button onclick="deleteTask(${task.id})" style="color: red;">Delete</button>-->
<!--            </td>-->

<!--        `;-->
<!--        tbody.appendChild(row);-->
<!--    });-->
<!--}-->

function renderTasks(tasks) {
    const tbody = document.getElementById('taskTableBody');
    tbody.innerHTML = '';
    tasks.forEach(task => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${task.title}</td>
            <td>${task.description}</td>
            <td>
                <button
                    onclick="toggleComplete(${task.id}, ${task.completed})"
                    ${task.completed ? 'disabled style="background: #d3d3d3;"' : ''}
                >
                    ${task.completed ? 'Done' : 'Pending'}
                </button>
            </td>
            <td>${task.dueDate || ''}</td>
            <td>${task.priority || ''}</td>
            <td>${task.username || ''}</td>
            <td>
                <button onclick="deleteTask(${task.id})" style="color: red;">Delete</button>
            </td>
        `;
        tbody.appendChild(row);
    });
}


function filterCompleted(status) {
    fetch(`${apiBase}/completed?status=${status}`)
        .then(res => res.json())
        .then(data => renderTasks(data));
}

function sortByDueDate() {
    fetch(`${apiBase}/sorted`)
        .then(res => res.json())
        .then(data => renderTasks(data));
}

function filterByUsername() {
    const username = document.getElementById('userFilter').value.trim();
    if (!username) return;
    fetch(`${apiBase}/user/${username}`)
        .then(res => res.json())
        .then(data => renderTasks(data));
}

<!--function toggleComplete(id, currentStatus) {-->
<!--    // First, get the full task to update all fields because PUT expects full object-->
<!--    fetch(`${apiBase}/${id}`)-->
<!--        .then(res => res.json())-->
<!--        .then(task => {-->
<!--            task.completed = !currentStatus;-->
<!--            return fetch(`${apiBase}/${id}`, {-->
<!--                method: 'PUT',-->
<!--                headers: { 'Content-Type': 'application/json' },-->
<!--                body: JSON.stringify(task)-->
<!--            });-->
<!--        })-->
<!--        .then(() => loadTasks());-->
<!--}-->

function toggleComplete(id, currentStatus) {
    // If already completed, do nothing
    if (currentStatus) return;

    // Proceed only if the current status is "Pending" (false)
    fetch(`${apiBase}/${id}`)
        .then(res => res.json())
        .then(task => {
            task.completed = true; // Force completion
            return fetch(`${apiBase}/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(task)
            });
        })
        .then(() => loadTasks())
        .catch(err => alert(err.message));
}


function loadTasks() {
    fetch(apiBase)
        .then(res => res.json())
        .then(data => renderTasks(data));
}

window.onload = () => {
    loadTasks();
};

// Handle form submission via AJAX
document.getElementById('taskForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const form = e.target;
    const formData = new FormData(form);

    // Build task JSON object
    const task = {
        title: formData.get('title'),
        description: formData.get('description'),
        dueDate: formData.get('dueDate') || null,
        priority: formData.get('priority'),
        username: formData.get('username'),
        completed: false
    };

    fetch(apiBase, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(task)
    })
    .then(res => {
        if (!res.ok) throw new Error('Failed to add task');
        return res.json();
    })
    .then(newTask => {
        loadTasks();
        form.reset();
    })
    .catch(err => alert(err.message));
});

function deleteTask(id) {
    if (!confirm('Are you sure you want to delete this task?')) return;

    fetch(`${apiBase}/${id}`, {
        method: 'DELETE'
    })
    .then(res => {
        if (!res.ok) throw new Error('Failed to delete task');
        loadTasks(); // Reload the tasks after deletion
    })
    .catch(err => alert(err.message));
}


</script>
</body>
</html>
